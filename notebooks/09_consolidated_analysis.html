<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Experimento - Classificação Preliminar</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="09_consolidated_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="09_consolidated_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="09_consolidated_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="09_consolidated_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="09_consolidated_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="09_consolidated_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="09_consolidated_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="09_consolidated_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="09_consolidated_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="09_consolidated_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#bibliotecas" id="toc-bibliotecas" class="nav-link active" data-scroll-target="#bibliotecas">Bibliotecas</a></li>
  <li><a href="#dados-brutos-da-amazon" id="toc-dados-brutos-da-amazon" class="nav-link" data-scroll-target="#dados-brutos-da-amazon">Dados brutos da Amazon</a></li>
  <li><a href="#análise" id="toc-análise" class="nav-link" data-scroll-target="#análise">Análise</a>
  <ul class="collapse">
  <li><a href="#categorias-definidas-pelos-vendedores" id="toc-categorias-definidas-pelos-vendedores" class="nav-link" data-scroll-target="#categorias-definidas-pelos-vendedores">Categorias definidas pelos vendedores</a></li>
  <li><a href="#documentos-no-espaço-vetorial-agrupados-por-categoria" id="toc-documentos-no-espaço-vetorial-agrupados-por-categoria" class="nav-link" data-scroll-target="#documentos-no-espaço-vetorial-agrupados-por-categoria">Documentos no espaço vetorial agrupados por categoria</a></li>
  </ul></li>
  <li><a href="#amostra-dos-dados-brutos" id="toc-amostra-dos-dados-brutos" class="nav-link" data-scroll-target="#amostra-dos-dados-brutos">Amostra dos dados brutos</a>
  <ul class="collapse">
  <li><a href="#amostra-dos-documentos-no-espaço-vetorial-agrupados-por-tipo-de-produto" id="toc-amostra-dos-documentos-no-espaço-vetorial-agrupados-por-tipo-de-produto" class="nav-link" data-scroll-target="#amostra-dos-documentos-no-espaço-vetorial-agrupados-por-tipo-de-produto">Amostra dos documentos no espaço vetorial agrupados por tipo de produto</a></li>
  <li><a href="#agrupamento-em-duas-ou-três-classes" id="toc-agrupamento-em-duas-ou-três-classes" class="nav-link" data-scroll-target="#agrupamento-em-duas-ou-três-classes">Agrupamento em duas ou três classes</a></li>
  </ul></li>
  <li><a href="#construção-de-classificadores" id="toc-construção-de-classificadores" class="nav-link" data-scroll-target="#construção-de-classificadores">Construção de classificadores</a>
  <ul class="collapse">
  <li><a href="#métricas-de-desempenho-do-classificador" id="toc-métricas-de-desempenho-do-classificador" class="nav-link" data-scroll-target="#métricas-de-desempenho-do-classificador">Métricas de desempenho do classificador</a></li>
  <li><a href="#classificador-binário-produtos-diversos-vs-produtos-para-telecomunicações" id="toc-classificador-binário-produtos-diversos-vs-produtos-para-telecomunicações" class="nav-link" data-scroll-target="#classificador-binário-produtos-diversos-vs-produtos-para-telecomunicações">Classificador binário: produtos diversos vs produtos para telecomunicações</a></li>
  <li><a href="#classificador-de-três-classes-produtos-diversos-vs-produtos-para-telecomunicações-vs-produtos-emissores-de-rf" id="toc-classificador-de-três-classes-produtos-diversos-vs-produtos-para-telecomunicações-vs-produtos-emissores-de-rf" class="nav-link" data-scroll-target="#classificador-de-três-classes-produtos-diversos-vs-produtos-para-telecomunicações-vs-produtos-emissores-de-rf">Classificador de três classes: produtos diversos vs produtos para telecomunicações vs produtos emissores de RF</a></li>
  <li><a href="#classificador-binário-produtos-diversos-vs-transmissores-de-rf" id="toc-classificador-binário-produtos-diversos-vs-transmissores-de-rf" class="nav-link" data-scroll-target="#classificador-binário-produtos-diversos-vs-transmissores-de-rf">Classificador binário: produtos diversos vs transmissores de RF</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Experimento - Classificação Preliminar</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="bibliotecas" class="level2">
<h2 class="anchored" data-anchor-id="bibliotecas">Bibliotecas</h2>
<div id="52989da2-a5e5-4fad-93a3-36f9d9462161" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unidecode</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> TruncatedSVD</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDClassifier</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> ConfusionMatrixDisplay</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> string <span class="im">import</span> punctuation</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e9b317e8-07ae-490b-96e2-c02c74111334" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Settings the warnings to be ignored </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="84294bc6-e399-4b19-a6a0-4b300e0d6b2d" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>html</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>style<span class="op">&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>table {<span class="bu">float</span>:left}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>style<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>
table {float:left}
</style>
</div>
</div>
<div id="2c1702ee-fbb9-42a6-be13-871fc061a3b5" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>NULL_STRING <span class="op">=</span> <span class="st">'#NULLO#'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>MAX_CAT_COUNT <span class="op">=</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b7ba713e-195e-48a1-a47e-ea53aa34abab" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_donut(labels,values,title,startangle<span class="op">=</span><span class="dv">30</span>):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>), subplot_kw<span class="op">=</span><span class="bu">dict</span>(aspect<span class="op">=</span><span class="st">"equal"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    wedges, texts <span class="op">=</span> ax.pie(values, wedgeprops<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>), startangle<span class="op">=</span>startangle)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    bbox_props <span class="op">=</span> <span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round,pad=0.3"</span>, fc<span class="op">=</span><span class="st">"w"</span>, ec<span class="op">=</span><span class="st">"k"</span>, lw<span class="op">=</span><span class="fl">0.72</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    kw <span class="op">=</span> <span class="bu">dict</span>(arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-"</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>              bbox<span class="op">=</span>bbox_props, zorder<span class="op">=</span><span class="dv">0</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    kw <span class="op">=</span> <span class="bu">dict</span>(arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-"</span>),bbox<span class="op">=</span>bbox_props,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>              zorder<span class="op">=</span><span class="dv">0</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, p <span class="kw">in</span> <span class="bu">enumerate</span>(wedges):</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        ang <span class="op">=</span> (p.theta2 <span class="op">-</span> p.theta1)<span class="op">/</span><span class="fl">2.</span> <span class="op">+</span> p.theta1</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> np.sin(np.deg2rad(ang))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.cos(np.deg2rad(ang))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        horizontalalignment <span class="op">=</span> {<span class="op">-</span><span class="dv">1</span>: <span class="st">"right"</span>, <span class="dv">1</span>: <span class="st">"left"</span>}[<span class="bu">int</span>(np.sign(x))]</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        connectionstyle <span class="op">=</span> <span class="st">"angle,angleA=0,angleB=</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(ang)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        kw[<span class="st">"arrowprops"</span>].update({<span class="st">"connectionstyle"</span>: connectionstyle})</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        ax.annotate(labels[i], xy<span class="op">=</span>(x, y), xytext<span class="op">=</span>(<span class="fl">1.35</span><span class="op">*</span>np.sign(x), <span class="fl">1.4</span><span class="op">*</span>y),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                    horizontalalignment<span class="op">=</span>horizontalalignment, <span class="op">**</span>kw)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e6fa18ba-db94-4766-a561-a56e10a14d5f" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tokenizer(doc):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> doc.lower()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> unidecode.unidecode(doc)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># uniformizar termos</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    patterns <span class="op">=</span> [(<span class="st">'wi\s?.?fi'</span>, <span class="st">'wifi'</span>), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                (<span class="st">'2,4'</span>, <span class="st">'2.4'</span>), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                (<span class="st">'5,8'</span>, <span class="st">'5.8'</span>)]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pattern, repl <span class="kw">in</span> patterns:</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        doc <span class="op">=</span> re.sub(pattern, repl, doc)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    stop_words <span class="op">=</span> stopwords.words(<span class="st">'portuguese'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    stop_words.extend(stopwords.words(<span class="st">'english'</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    stop_words.extend(<span class="bu">list</span>(punctuation))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stopwords específicas do domínio</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    stop_words.extend([<span class="st">'cm'</span>, <span class="st">'feature'</span>, <span class="st">'features'</span>, <span class="st">'informações'</span>, <span class="st">'itens'</span>, <span class="st">'leve'</span>, <span class="st">'list'</span>, <span class="st">'nulo'</span>, <span class="st">'package'</span>, <span class="st">'pacote'</span>, <span class="st">'pacotes'</span>, <span class="st">'recurso'</span>, <span class="st">'tamanho'</span>, <span class="st">'ver'</span>, <span class="st">'unidades'</span>, <span class="st">'fio'</span>, <span class="st">'universal'</span>])</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cores mais comumns</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    stop_words.extend([<span class="st">'preto'</span>, <span class="st">'cinza'</span>, <span class="st">'branco'</span>, <span class="st">'rosa'</span>, <span class="st">'vermelho'</span>, <span class="st">'laranja'</span>, <span class="st">'amarelo'</span>, <span class="st">'verde'</span>, <span class="st">'azul'</span>, <span class="st">'roxo'</span>, <span class="st">'marrom'</span>])</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remover da lista de stopwords a palavra sem para formar o bigrama "sem fio", que pode ser relevante para o domínio</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stop_words.remove('sem') </span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    tokens <span class="op">=</span> [token <span class="cf">for</span> token <span class="kw">in</span> word_tokenize(doc) <span class="cf">if</span> token <span class="kw">not</span> <span class="kw">in</span> stop_words]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tokens</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> doc_cleaner(doc):</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    tokens <span class="op">=</span> tokenizer(doc)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">' '</span>.join(tokens) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="4e27eb94-b5db-4b22-a448-9a3642977088" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_docs_matrix(docs_matrix, true_targets<span class="op">=</span><span class="va">None</span>, predicted_targets<span class="op">=</span><span class="va">None</span>, title<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> TruncatedSVD(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    pca_matrix <span class="op">=</span> pca.fit_transform(docs_matrix)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    scatter_x <span class="op">=</span> pca_matrix[:, <span class="dv">0</span>] <span class="co"># first principle component</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    scatter_y <span class="op">=</span> pca_matrix[:, <span class="dv">1</span>] <span class="co"># second principle component</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> predicted_targets <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        fig,ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> true_targets <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> group <span class="kw">in</span> np.unique(true_targets):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                ix <span class="op">=</span> np.where(true_targets <span class="op">==</span> group)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                ax.scatter(scatter_x[ix], scatter_y[ix], label<span class="op">=</span>group, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> title <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                    ax.set_title(<span class="st">'Documentos por categoria</span><span class="ch">\n</span><span class="st">(Real)'</span>)   </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                    ax.set_title(title)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            ax.scatter(scatter_x, scatter_y, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> title <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                ax.set_title(<span class="st">'Documentos'</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                ax.set_title(title)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks([])</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        ax.set_yticks([])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> true_targets <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> group <span class="kw">in</span> np.unique(true_targets):</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                ix <span class="op">=</span> np.where(true_targets <span class="op">==</span> group)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                axs[<span class="dv">0</span>].scatter(scatter_x[ix], scatter_y[ix], label<span class="op">=</span>group, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> title <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                    axs[<span class="dv">0</span>].set_title(<span class="st">'Documentos por categoria</span><span class="ch">\n</span><span class="st">(Real)'</span>)   </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                    axs[<span class="dv">0</span>].set_title(title)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            axs[<span class="dv">0</span>].scatter(scatter_x, scatter_y, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> title <span class="kw">is</span> none:</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                axs[<span class="dv">0</span>].set_title(<span class="st">'Documentos'</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                axs[<span class="dv">0</span>].set_title(title)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group <span class="kw">in</span> np.unique(predicted_targets):</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            ix <span class="op">=</span> np.where(predicted_targets <span class="op">==</span> group)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            axs[<span class="dv">1</span>].scatter(scatter_x[ix], scatter_y[ix], label<span class="op">=</span>group, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            axs[<span class="dv">1</span>].set_title(<span class="st">'Agrupamento por categoria</span><span class="ch">\n</span><span class="st">(K-Means)'</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ax <span class="kw">in</span> axs.flat:</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            ax.set_xticks([])</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            ax.set_yticks([])</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="6485020b-170d-4947-99c8-bc6ace0dff96" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_produtcs_matrix(docs_matrix, targets<span class="op">=</span><span class="va">None</span>, title<span class="op">=</span><span class="va">None</span>, legend_map<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> TruncatedSVD(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    pca_matrix <span class="op">=</span> pca.fit_transform(docs_matrix)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    scatter_x <span class="op">=</span> pca_matrix[:, <span class="dv">0</span>] <span class="co"># first principle component</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    scatter_y <span class="op">=</span> pca_matrix[:, <span class="dv">1</span>] <span class="co"># second principle component</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        fig,ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        showplot <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        showplot <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> group <span class="kw">in</span> np.unique(targets):</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> legend_map <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            group_label <span class="op">=</span> legend_map[group]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            group_label <span class="op">=</span> group</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        ix <span class="op">=</span> np.where(targets <span class="op">==</span> group)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        ax.scatter(scatter_x[ix], scatter_y[ix], label<span class="op">=</span>group_label, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> title <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            ax.set_title(title)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks([])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([])</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showplot:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="095b2801-1f89-4a0e-9388-c930a7198ad6" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_wordcloud(wc_docs,max_words<span class="op">=</span><span class="dv">50</span>,ax<span class="op">=</span><span class="va">None</span>,title<span class="op">=</span><span class="st">'Principais palavras'</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(wc_docs, <span class="st">'__iter__'</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        wc_docs <span class="op">=</span> <span class="st">' '</span>.join(wc_docs)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    wc <span class="op">=</span> WordCloud(max_words<span class="op">=</span>max_words,height<span class="op">=</span><span class="dv">300</span>).generate(wc_docs)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        fig,ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        show_plt <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        show_plt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    ax.imshow(wc, interpolation<span class="op">=</span><span class="st">"bilinear"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">"off"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_plt:</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dados-brutos-da-amazon" class="level2">
<h2 class="anchored" data-anchor-id="dados-brutos-da-amazon">Dados brutos da Amazon</h2>
<div id="3c000094-be35-46ee-8686-91e5cf56fc0e" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!hide: true</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>raw_amazon_dataset <span class="op">=</span> <span class="st">'../datasets/amazon_reindexed.parquet'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df_amazon <span class="op">=</span> pd.read_parquet(raw_amazon_dataset)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df_amazon.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Link</th>
<th data-quarto-table-cell-role="th">Palavra_Chave</th>
<th data-quarto-table-cell-role="th">cat_0</th>
<th data-quarto-table-cell-role="th">cat_1</th>
<th data-quarto-table-cell-role="th">cat_2</th>
<th data-quarto-table-cell-role="th">cat_3</th>
<th data-quarto-table-cell-role="th">cat_4</th>
<th data-quarto-table-cell-role="th">cat_5</th>
<th data-quarto-table-cell-role="th">Marca</th>
<th data-quarto-table-cell-role="th">Modelo</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Vendedor</th>
<th data-quarto-table-cell-role="th">Data_Inclusão</th>
<th data-quarto-table-cell-role="th">Ativo</th>
<th data-quarto-table-cell-role="th">Descrição_Principal</th>
<th data-quarto-table-cell-role="th">Link_Vendedor</th>
<th data-quarto-table-cell-role="th">Preço_Original</th>
<th data-quarto-table-cell-role="th">Qtd_disponível</th>
<th data-quarto-table-cell-role="th">Qtd_vendidos</th>
<th data-quarto-table-cell-role="th">Desconto</th>
<th data-quarto-table-cell-role="th">Estado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>https://www.amazon.com.br/Especiais-Cinematic-...</td>
<td>drone</td>
<td>Eletrônicos e Tecnologia</td>
<td>Câmeras e Foto</td>
<td>Acessórios</td>
<td>Filtros</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>Odorkle</td>
<td>#NULLO#</td>
<td>...</td>
<td>Lantacy</td>
<td>2024-03-06 01:49:12</td>
<td>True</td>
<td>Modelo aplicável: este filtro de listras azuis...</td>
<td>https://www.amazon.com.br/gp/help/seller/at-a-...</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>https://www.amazon.com.br/Motores-Escova-Conju...</td>
<td>drone</td>
<td>Eletrônicos e Tecnologia</td>
<td>Câmeras e Foto</td>
<td>Acessórios</td>
<td>Acessórios para Drones</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>Airshi</td>
<td>Airshimowq96xigy-11</td>
<td>...</td>
<td>Aiterwu</td>
<td>2024-03-06 01:49:00</td>
<td>True</td>
<td>Fonte de alimentação: este motor sem escova de...</td>
<td>https://www.amazon.com.br/gp/help/seller/at-a-...</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>https://www.amazon.com.br/Armazenamento-Protet...</td>
<td>drone</td>
<td>Brinquedos e Jogos</td>
<td>Brinquedos de Controle Remoto</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>Zhjvihx</td>
<td>#NULLO#</td>
<td>...</td>
<td>Zhjvihx-US</td>
<td>2024-03-06 01:48:46</td>
<td>True</td>
<td>Válvula de Alívio de Pressão: Equipada com vál...</td>
<td>https://www.amazon.com.br/gp/help/seller/at-a-...</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>https://www.amazon.com.br/EQUSS-V-strom-Motoci...</td>
<td>drone</td>
<td>Eletrônicos e Tecnologia</td>
<td>Câmeras e Foto</td>
<td>Acessórios</td>
<td>Acessórios para Drones</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>Equss</td>
<td>EQUSS</td>
<td>...</td>
<td>Dengzhoushilianzhouqichepeijianshanghang</td>
<td>2024-03-06 01:48:26</td>
<td>True</td>
<td>[Super Grip] - Design criativo, quatro suporte...</td>
<td>https://www.amazon.com.br/gp/help/seller/at-a-...</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>https://www.amazon.com.br/remote-control-brush...</td>
<td>drone</td>
<td>Eletrônicos e Tecnologia</td>
<td>Câmeras e Foto</td>
<td>Acessórios</td>
<td>Acessórios para Drones</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>Uxsiya</td>
<td>Uxsiyay49ekqxi1t</td>
<td>...</td>
<td>Mseinope-US</td>
<td>2024-03-06 01:48:14</td>
<td>True</td>
<td>#NULLO#</td>
<td>https://www.amazon.com.br/gp/help/seller/at-a-...</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
<td>#NULLO#</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="análise" class="level2">
<h2 class="anchored" data-anchor-id="análise">Análise</h2>
<section id="categorias-definidas-pelos-vendedores" class="level3">
<h3 class="anchored" data-anchor-id="categorias-definidas-pelos-vendedores">Categorias definidas pelos vendedores</h3>
<p>Os dados brutos da Amazon contém 151.782 registros, desdes, 100.406 não possuem categorias definidas pelos vendedores enquanto os demais estão distribuídos em outras 30 categorias primárias.</p>
<p>Quase a totalidade dos dados estão distribuídos em duas categorias princiais: 97,8% dos produtos pertencem às categorias “Eletrônicos e Tecnologia” ou “Computadores e Informática”</p>
<div id="fb63c910-be13-4b3b-a0c3-aa1c6fd4b6f4" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! hide: true</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">'cat_0'</span>, <span class="st">'Nome'</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_categories <span class="op">=</span> df_amazon[columns_to_keep].groupby(<span class="st">'cat_0'</span>,as_index<span class="op">=</span><span class="va">False</span>).count().sort_values(by<span class="op">=</span><span class="st">'Nome'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df_categories <span class="op">=</span> df_categories.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df_categories.columns <span class="op">=</span> [<span class="st">'cat_0'</span>, <span class="st">'count'</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>map_cat_0 <span class="op">=</span> {k:(v <span class="cf">if</span> v <span class="op">&lt;</span> MAX_CAT_COUNT <span class="cf">else</span> MAX_CAT_COUNT) <span class="cf">for</span> v,k <span class="kw">in</span> df_categories.cat_0.to_dict().items()}</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df_categories[<span class="st">'cat_0_int'</span>] <span class="op">=</span> df_categories[<span class="st">'cat_0'</span>].<span class="bu">map</span>(map_cat_0)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>df_categories[<span class="st">'cum_sum'</span>] <span class="op">=</span> df_categories[<span class="st">'count'</span>].cumsum()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>df_categories[<span class="st">'cum_part'</span>] <span class="op">=</span> df_categories[<span class="st">'cum_sum'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x<span class="op">/</span>df_categories[<span class="st">'count'</span>].<span class="bu">sum</span>()<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">'cat_0_int'</span>, <span class="st">'count'</span>]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>df_top_categories <span class="op">=</span> df_categories[columns_to_keep].groupby(<span class="st">'cat_0_int'</span>,as_index<span class="op">=</span><span class="va">False</span>).<span class="bu">sum</span>()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>map_cat_0_int <span class="op">=</span> {<span class="dv">0</span>: <span class="st">'Sem categoria'</span>, <span class="dv">1</span>: <span class="st">'Eletrônicos e Tecnologia'</span>, <span class="dv">2</span>: <span class="st">'Computadores e Informática'</span>, <span class="dv">3</span>: <span class="st">'Outras'</span>}</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>df_top_categories[<span class="st">'top_cat'</span>] <span class="op">=</span> df_top_categories[<span class="st">'cat_0_int'</span>].<span class="bu">map</span>(map_cat_0_int)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">'top_cat'</span>, <span class="st">'count'</span>]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>df_top_categories <span class="op">=</span> df_top_categories.set_index(<span class="st">'cat_0_int'</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>df_top_categories <span class="op">=</span> df_top_categories[columns_to_keep]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">'Categoria'</span>, <span class="st">'Quantidade'</span>]</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>df_top_categories.columns <span class="op">=</span> columns_to_keep</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(df_top_categories,showindex<span class="op">=</span><span class="va">False</span>,headers<span class="op">=</span>columns_to_keep,intfmt<span class="op">=</span><span class="st">','</span>,tablefmt<span class="op">=</span><span class="st">'rounded_grid'</span>).replace(<span class="st">','</span>,<span class="st">'.'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╭────────────────────────────┬──────────────╮
│ Categoria                  │   Quantidade │
├────────────────────────────┼──────────────┤
│ Sem categoria              │      100.406 │
├────────────────────────────┼──────────────┤
│ Eletrônicos e Tecnologia   │       39.062 │
├────────────────────────────┼──────────────┤
│ Computadores e Informática │       11.194 │
├────────────────────────────┼──────────────┤
│ Outras                     │        1.120 │
╰────────────────────────────┴──────────────╯</code></pre>
</div>
</div>
<div id="9d1a0737-98ef-456f-ba34-bb6ee6ce75f9" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! hide: true</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df_top_categories[<span class="st">'Categoria'</span>].to_numpy()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> df_top_categories[<span class="st">'Quantidade'</span>].to_numpy()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">'Quantidade de produtos por categoria'</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>startangle <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plot_donut(labels, values, title, startangle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="documentos-no-espaço-vetorial-agrupados-por-categoria" class="level3">
<h3 class="anchored" data-anchor-id="documentos-no-espaço-vetorial-agrupados-por-categoria">Documentos no espaço vetorial agrupados por categoria</h3>
<p>A visualização dos documentos no espaço vetorial, considerando tanto o título do anúncio quanto a descrição, quando existente, mostrou que as categorias indicadas pelos vendedores podem não ser um bom fator discriminante pois há grande sobreposição de categorias de documentos.</p>
<p>A aplicação do algortimo de agrupamento K-Means refletiu a sobreposição das categorias e agrupou documentos com categorias sobrepostas em um mesmo grupo.</p>
<div id="fa99c411-6bd4-4eeb-8d46-0b2da4762c86" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! hide: true</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">'Nome'</span>,<span class="st">'cat_0'</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_docs <span class="op">=</span> df_amazon[df_amazon[<span class="st">'cat_0'</span>]<span class="op">!=</span>NULL_STRING][columns_to_keep]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df_docs[<span class="st">'cat_0'</span>] <span class="op">=</span> df_docs[<span class="st">'cat_0'</span>].<span class="bu">map</span>(map_cat_0)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> df_docs[<span class="st">'Nome'</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> df_docs[<span class="st">'cat_0'</span>]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>docs_matrix <span class="op">=</span> vectorizer.fit_transform(docs)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>kmeans_nome <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>, max_iter<span class="op">=</span><span class="dv">500</span>, n_init<span class="op">=</span><span class="dv">1</span>).fit(docs_matrix)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>predicted_targets <span class="op">=</span> kmeans_nome.labels_</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plot_docs_matrix(docs_matrix,true_targets<span class="op">=</span>targets,predicted_targets<span class="op">=</span>predicted_targets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Observando as principais palavras das categorias e dos grupos (clusters) obtidos através do K-Means, verifica-se mais uma indicação de que as categorias indicadas podem não ser mais adequadas para separação dos produtos.</p>
<p>Observa-se, por exemplo, que as palavras transmissor e wifi são relevantes para as categorias 2 e 3, fone e ouvido para as categorias 1 e 2.</p>
<p>Nos grupos (clusters) preditos pelo K-Means fica como primeira precepção que um grupo contém telefones celulares e acessórios, outro contém carregadores e baterias e o terceiro produtos relacionados a aúdio.</p>
<div id="797bccdb-ac78-4044-a9f4-24e7414f766c" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! hide: true</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>clean_docs <span class="op">=</span> docs.<span class="bu">map</span>(doc_cleaner).values</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>fig,axs<span class="op">=</span>plt.subplots(<span class="dv">2</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">18</span>,<span class="dv">10</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,target <span class="kw">in</span> <span class="bu">enumerate</span>(np.unique(targets)):</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    ix <span class="op">=</span> np.where(targets<span class="op">==</span>target)[<span class="dv">0</span>]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    plot_wordcloud(clean_docs[ix],ax<span class="op">=</span>axs[<span class="dv">0</span>][i],title<span class="op">=</span><span class="ss">f'Principais palavras</span><span class="ch">\n</span><span class="ss">Categoria </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,target <span class="kw">in</span> <span class="bu">enumerate</span>(np.unique(predicted_targets)):</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    ix <span class="op">=</span> np.where(predicted_targets<span class="op">==</span>target)[<span class="dv">0</span>]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    plot_wordcloud(clean_docs[ix],ax<span class="op">=</span>axs[<span class="dv">1</span>][i],title<span class="op">=</span><span class="ss">f'Principais palavras</span><span class="ch">\n</span><span class="ss">Cluster </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="amostra-dos-dados-brutos" class="level2">
<h2 class="anchored" data-anchor-id="amostra-dos-dados-brutos">Amostra dos dados brutos</h2>
<p>Como alternativa à utilização das categorias informadas pelos vendedores foi selecionada uma amostra de até 10 exemplos de cada categoria completa (categoria principal e até 5 subcategorias) para análise e anotação do tipo do produto.</p>
<p>Foram selecionados e anotados 2.091 exemplos, em 29 tipo de produt. A maioria dos produtos diversos, ou seja, não destinados a telecomunicações foram classificados como Outros. Produtos para telecomunicações foram classificados conforme o tipo, além desses, produtos diversos em quantidade relevante foram classificados conforme o tipo.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Tipo de Produto</th>
<th style="text-align: right;">Quantidade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Outros</td>
<td style="text-align: right;">943</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transceptor de Radiação Restrita</td>
<td style="text-align: right;">599</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cabo (em geral)</td>
<td style="text-align: right;">89</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transceptor de RF (HF/VHF/UHF)</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Microfone sem fio</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">Desktop/Notebook</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fone de ouvido sem fio</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Carregadores e fontes (eletrônicos em geral)</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Câmera sem fio</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">Carregador de celular</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Impressora e cartuchos</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Roteador/Reforçador WiFi</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Antena</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baterias (eletrônicos em geral)</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Extensor de vídeo VGA/HDMI</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tablets</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Carregador sem fio</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Telefone celular</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Transceptor/Conversor SFP</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cartão de memória</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Drone</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smartwatch</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Carregador portátil (powerbank)</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cabo de rede</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reforçador de sinal de celular</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smart TV</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hub Switch</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>|Modem 3G/4G/WiFi|2| |TV Box|2|</p>
<p>A grande quantidade de tipos de produtos com poucos exemplos torna o processo de aprendizagem de máquina pois há grande sobreposição de exemplos, tornando difícil a correta identificação do produto.</p>
<p>Esse cenário já era esperado pois alguns tipos de produtos podem ser detinados para telecomunicações em determinados cenários e não destinados a telecomunicações em outros cenários, como por exemplos, cabos, fontes, carregadores, baterias, etc.</p>
<section id="amostra-dos-documentos-no-espaço-vetorial-agrupados-por-tipo-de-produto" class="level3">
<h3 class="anchored" data-anchor-id="amostra-dos-documentos-no-espaço-vetorial-agrupados-por-tipo-de-produto">Amostra dos documentos no espaço vetorial agrupados por tipo de produto</h3>
<p>A visualização da amostra dos documentos no espaço vetorial mostrou que há sobreposição de tipos de produtos com poucos exemplos ao passo que indicou a possibiliade de separação em dois ou três grupos.</p>
<div id="d255d56a-4b8c-4243-b729-63a3e4162603" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! hide: true</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>file_cat_sample <span class="op">=</span> <span class="st">'../datasets/cat_to_label_sample.xlsx'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>df_cat_sample <span class="op">=</span> pd.read_excel(file_cat_sample)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_cat_sample <span class="op">=</span> df_cat_sample.iloc[:,<span class="op">-</span><span class="dv">2</span>:]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>df_cat_sample <span class="op">=</span> df_cat_sample.dropna()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>df_cat_sample.columns <span class="op">=</span> [<span class="st">'doc'</span>, <span class="st">'labeled_category'</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>map_category_to_int <span class="op">=</span> {category:i <span class="cf">for</span> i,category <span class="kw">in</span> <span class="bu">enumerate</span>(df_cat_sample.labeled_category.unique())}</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>map_category_to_name <span class="op">=</span> {i:category <span class="cf">for</span> category,i <span class="kw">in</span> map_category_to_int.items()}</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>df_cat_sample[<span class="st">'category'</span>] <span class="op">=</span> df_cat_sample[<span class="st">'labeled_category'</span>].<span class="bu">map</span>(map_category_to_int)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> df_cat_sample[<span class="st">'category'</span>]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>docs_matrix <span class="op">=</span> vectorizer.fit_transform(docs)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>plot_docs_matrix(docs_matrix,true_targets<span class="op">=</span>targets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="agrupamento-em-duas-ou-três-classes" class="level3">
<h3 class="anchored" data-anchor-id="agrupamento-em-duas-ou-três-classes">Agrupamento em duas ou três classes</h3>
<p>Os produtos da amostra foram reclassificados em duas categorias: produtos diversos e produtos para telecomunicações. Os produtos para telecomunicações foram classificados ainda em protudos transmissores de radiofrequencia e produtos não transmissores de radiofrequência.</p>
<div id="0743d5ff-0616-4fa4-ae5f-4ec1a76f89e8" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_cat_sample['clean_doc'] = df_cat_sample.doc.map(doc_cleaner)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># columns_to_keep = ['doc', 'clean_doc', 'labeled_category', 'telecom_product', 'rf_transmitter', 'category']</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_cat_sample = df_cat_sample[columns_to_keep]</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df_cat_sample</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>map_telecom_product <span class="op">=</span> {<span class="st">'Antena'</span>: <span class="dv">1</span>,  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Baterias (eletrônicos em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Cabo (em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Cabo de rede'</span>: <span class="dv">1</span>, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Câmera sem fio'</span>: <span class="dv">1</span>, </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Carregador de celular'</span>: <span class="dv">1</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Carregador portátil (powerbank)'</span>: <span class="dv">1</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Carregador sem fio'</span>: <span class="dv">1</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Carregadores e fontes (eletrônicos em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Cartão de memória'</span>: <span class="dv">0</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Desktop/Notebook'</span>: <span class="dv">0</span>, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Drone'</span>: <span class="dv">1</span>, </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Extensor de vídeo VGA/HDMI'</span>: <span class="dv">0</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Fone de ouvido sem fio'</span>: <span class="dv">1</span>, </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Hub Switch'</span>: <span class="dv">1</span>, </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Impressora e cartuchos'</span>: <span class="dv">0</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Microfone sem fio'</span>: <span class="dv">1</span>, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Modem 3G/4G/WiFi'</span>: <span class="dv">1</span>, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Outros'</span>: <span class="dv">0</span>, </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Reforçador de sinal de celular'</span>: <span class="dv">1</span>, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Roteador/Reforçador WiFi'</span>: <span class="dv">1</span>, </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Smart TV'</span>: <span class="dv">1</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Smartwatch'</span>: <span class="dv">1</span>, </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Tablets'</span>: <span class="dv">1</span>, </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Telefone celular'</span>: <span class="dv">1</span>, </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Transceptor de Radiação Restrita'</span>: <span class="dv">1</span>, </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Transceptor de RF (HF/VHF/UHF)'</span>: <span class="dv">1</span>, </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Transceptor/Conversor SFP'</span>: <span class="dv">1</span>, </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'TV Box'</span>: <span class="dv">1</span>}</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>map_rf_transmitter <span class="op">=</span> {<span class="st">'Antena'</span>: <span class="dv">1</span>,  </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Baterias (eletrônicos em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Cabo (em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Cabo de rede'</span>: <span class="dv">1</span>, </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Câmera sem fio'</span>: <span class="dv">2</span>, </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Carregador de celular'</span>: <span class="dv">1</span>,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Carregador portátil (powerbank)'</span>: <span class="dv">1</span>,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Carregador sem fio'</span>: <span class="dv">1</span>, </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Carregadores e fontes (eletrônicos em geral)'</span>: <span class="dv">0</span>, </span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Cartão de memória'</span>: <span class="dv">0</span>,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Desktop/Notebook'</span>: <span class="dv">0</span>, </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Drone'</span>: <span class="dv">2</span>, </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Extensor de vídeo VGA/HDMI'</span>: <span class="dv">0</span>, </span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Fone de ouvido sem fio'</span>: <span class="dv">2</span>, </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Hub Switch'</span>: <span class="dv">1</span>, </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Impressora e cartuchos'</span>: <span class="dv">0</span>,</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Microfone sem fio'</span>: <span class="dv">2</span>, </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Modem 3G/4G/WiFi'</span>: <span class="dv">2</span>, </span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Outros'</span>: <span class="dv">0</span>,                        </span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Reforçador de sinal de celular'</span>: <span class="dv">2</span>, </span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Roteador/Reforçador WiFi'</span>: <span class="dv">2</span>, </span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Smart TV'</span>: <span class="dv">2</span>,</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Smartwatch'</span>: <span class="dv">2</span>, </span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Tablets'</span>: <span class="dv">2</span>, </span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Telefone celular'</span>: <span class="dv">2</span>, </span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Transceptor de Radiação Restrita'</span>: <span class="dv">2</span>, </span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Transceptor de RF (HF/VHF/UHF)'</span>: <span class="dv">2</span>, </span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Transceptor/Conversor SFP'</span>: <span class="dv">1</span>, </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'TV Box'</span>: <span class="dv">2</span>}</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>df_cat_sample[<span class="st">'telecom_product'</span>] <span class="op">=</span> df_cat_sample[<span class="st">'labeled_category'</span>].<span class="bu">map</span>(map_telecom_product)</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>df_cat_sample[<span class="st">'rf_transmitter'</span>] <span class="op">=</span> df_cat_sample[<span class="st">'labeled_category'</span>].<span class="bu">map</span>(map_rf_transmitter)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>docs_sample <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>]</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> df_cat_sample[<span class="st">'telecom_product'</span>]</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>targets_rf <span class="op">=</span> df_cat_sample[<span class="st">'rf_transmitter'</span>]</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>docs_matrix <span class="op">=</span> vectorizer.fit_transform(docs_sample)</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>legend_map <span class="op">=</span> {<span class="dv">0</span>: <span class="st">'Produtos diversos'</span>, <span class="dv">1</span>: <span class="st">'Produtos para telecomunicações'</span>, <span class="dv">2</span>: <span class="st">'Produtos transmissores de RF'</span>}</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>plot_produtcs_matrix(docs_matrix,targets<span class="op">=</span>targets,legend_map<span class="op">=</span>legend_map,ax<span class="op">=</span>axs[<span class="dv">0</span>],title<span class="op">=</span><span class="st">'Produtos por tipo'</span>)</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>plot_produtcs_matrix(docs_matrix,targets<span class="op">=</span>targets_rf,legend_map<span class="op">=</span>legend_map,ax<span class="op">=</span>axs[<span class="dv">1</span>],title<span class="op">=</span><span class="st">'Produtos por tipo'</span>)</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Quando agrupados em duas ou três categorias observa-se, no espaço vetorial, uma sepação entre os grupos, principalmente entre produtos diversos e produtos de telecomunicações transmissores de radiofrequência, indicando a viabilidade de construção de um classificador.</p>
<p>Quando observadas as palavras mais frequentes em cada categoria observa-se que há palavras discriminantes das categorias, contudo, palavras presentes em mais de uma categoria (cabo, bateria, etc) que demonstram a sobreposição observada.</p>
<div id="1b18f73a-2eec-411b-95c3-a99cff71660c" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>clean_docs_sample <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>].<span class="bu">map</span>(doc_cleaner).values</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fig,axs<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">18</span>,<span class="dv">10</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,target <span class="kw">in</span> <span class="bu">enumerate</span>(np.unique(targets_rf)):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    ix <span class="op">=</span> np.where(targets_rf<span class="op">==</span>target)[<span class="dv">0</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    plot_wordcloud(clean_docs_sample[ix],ax<span class="op">=</span>axs[i],title<span class="op">=</span><span class="ss">f'Palavras mais frequentes</span><span class="ch">\n</span><span class="sc">{</span>legend_map[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="construção-de-classificadores" class="level2">
<h2 class="anchored" data-anchor-id="construção-de-classificadores">Construção de classificadores</h2>
<p>Foram contruídos dois classificadores para avaliação da viabilidade de separação dos produtos em dois ou três grupos distintos.</p>
<section id="métricas-de-desempenho-do-classificador" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempenho-do-classificador">Métricas de desempenho do classificador</h3>
<p>Antes de apresentar os classificadores e resultados obtidos é necessário apresentar brevemente algumas métricas utilizadas para avaliação de seu desempenho.</p>
<p>O desempenho do classificador pode ser medido utilizando-se como base a matriz de confusão: uma tabela que apresenta a quantidade de exemplos corretamente e incorretamente classificados.</p>
<p>Para classificações binária a matriz de confusão apresenta duas linhas e duas colunas que relatam a quantidade de de <em>falsos positivos (FP)</em>, <em>falsos negativos (FN)</em>, <em>verdadeiros positivos (VP)</em> e <em>verdadeiros negativos (VN)</em>. Isso permite uma análise mais detalhada do que a mera proporção de classificações corretas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="confusion_600.png" class="img-fluid figure-img"></p>
<figcaption>confusion</figcaption>
</figure>
</div>
<p>A partir da matriz de confusão derivam-se duas medidas: precisão (<em>precision</em>) e sensibilidade (<em>recall</em>).</p>
<p>A precisão é uma métrica que avalia a quantidade de verdadeiros positivos sobre a soma de todos os valores positivos. Em outras palavras, é a capacidade do modelo de classificar corretamente os verdadeiros positivos, evitando falsos positivos.</p>
<p><span class="math inline">\(Precisão = \frac{VP}{VP+FP}\)</span></p>
<p>A sensbilidade avalia a capacidade do método de detectar com sucesso resultados classificados como positivos. Em outras palavras, é a capacidade do modelo de encontrar corretamente os verdadeiros positivos, evitando falsos negativos.</p>
<p><span class="math inline">\(Sensibilidade = \frac{VP}{VP+FN}\)</span></p>
<p>A curva ROC, do inglês Receiver Operating Characteristic Curve, ou na tradução “Curva Característica de Operação do Receptor” é um gráfico que permite avaliar um classificador binário. Essa visualização leva em consideração a taxa de verdadeiros positivos e a taxa de falsos positivos. Esse gráfico permite comparar diferentes classificadores e definir qual o melhor com base em diferentes pontos de corte. Na prática, quanto mais próximo do topo do eixo Y melhor o classificador.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="roc_400.png" class="img-fluid figure-img"></p>
<figcaption>roc</figcaption>
</figure>
</div>
<p>Uma curva ROC pode ser avaliada pela métrica AUC (Area Under the Curve ou “área sob a curva”). AUC calcula a área da forma bidimensional formada abaixo da curva. Essa métrica indica a probabilidade de duas previsões serem corretamente ranqueadas. A AUC será um valor entre 0 e 1. Quanto maior esse valor, melhor a capacidade do modelo em separar classes.</p>
<p>Mais informações sobre métricas de desempenho de classificadores pode ser obtida em:</p>
<p>https://glossario.maiconramos.com/glossario/o-que-e-precision-and-recall-precisao-e-revocacao/</p>
<p>https://diegomariano.com/metricas-de-avaliacao-em-machine-learning/</p>
<p>https://medium.com/<span class="citation" data-cites="ejunior029/principais-m%C3%A9tricas-de-classifica%C3%A7%C3%A3o-de-modelos-em-machine-learning-94eeb4b40ea9">@ejunior029/principais-m%C3%A9tricas-de-classifica%C3%A7%C3%A3o-de-modelos-em-machine-learning-94eeb4b40ea9</span></p>
</section>
<section id="classificador-binário-produtos-diversos-vs-produtos-para-telecomunicações" class="level3">
<h3 class="anchored" data-anchor-id="classificador-binário-produtos-diversos-vs-produtos-para-telecomunicações">Classificador binário: produtos diversos vs produtos para telecomunicações</h3>
<div id="45e2a886-0aa0-4f9f-a3ec-bd0c7c16df8a" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_cat_sample[<span class="st">'telecom_product'</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>target_names <span class="op">=</span> [<span class="st">'Produtos diversos'</span>, <span class="st">'Produtos para telecomunicações'</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>target_names_confusion <span class="op">=</span> [<span class="st">'Produtos diversos'</span>, <span class="st">'Produtos para</span><span class="ch">\n</span><span class="st">telecomunicações'</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">724</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>tfidf_vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>X_train_tfidf <span class="op">=</span> tfidf_vectorizer.fit_transform(X_train)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>X_test_tfidf <span class="op">=</span> tfidf_vectorizer.transform(X_test)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>clf_sgd <span class="op">=</span> SGDClassifier(loss<span class="op">=</span><span class="st">'log_loss'</span>, penalty<span class="op">=</span><span class="st">'l2'</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">1e-3</span>, random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                        max_iter<span class="op">=</span><span class="dv">5</span>, tol<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>clf_sgd.fit(X_train_tfidf, y_train)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> clf_sgd.predict(X_test_tfidf)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on training set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_train_tfidf, y_train)))</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on test set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_test_tfidf, y_test)))</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'AUC of SGD classifier on test set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(roc_auc_score(y_test,clf_sgd.predict_proba(X_test_tfidf)[:,<span class="dv">1</span>])))</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predicted, target_names<span class="op">=</span>target_names))</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>ConfusionMatrixDisplay.from_predictions(y_test, predicted, ax<span class="op">=</span>ax)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(<span class="ss">f"Confusion Matrix for </span><span class="sc">{</span>clf_sgd<span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">on the original documents"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of SGD classifier on training set: 0.936
Accuracy of SGD classifier on test set: 0.860
AUC of SGD classifier on test set: 0.931

                                precision    recall  f1-score   support

             Produtos diversos       0.85      0.91      0.88       303
Produtos para telecomunicações       0.87      0.79      0.83       220

                      accuracy                           0.86       523
                     macro avg       0.86      0.85      0.85       523
                  weighted avg       0.86      0.86      0.86       523
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classificador-de-três-classes-produtos-diversos-vs-produtos-para-telecomunicações-vs-produtos-emissores-de-rf" class="level3">
<h3 class="anchored" data-anchor-id="classificador-de-três-classes-produtos-diversos-vs-produtos-para-telecomunicações-vs-produtos-emissores-de-rf">Classificador de três classes: produtos diversos vs produtos para telecomunicações vs produtos emissores de RF</h3>
<div id="6bd35c1e-bef8-491b-b42a-0d41dfbea9f9" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_cat_sample[<span class="st">'rf_transmitter'</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>target_names <span class="op">=</span> [<span class="st">'Produtos diversos'</span>, <span class="st">'Produtos para telecomunicações'</span>, <span class="st">'Transmissores de RF'</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>target_names_confusion <span class="op">=</span> [<span class="st">'Produtos diversos'</span>, <span class="st">'Produtos para</span><span class="ch">\n</span><span class="st">telecomunicações'</span>, <span class="st">'Transmissores de RF'</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">724</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>tfidf_vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>X_train_tfidf <span class="op">=</span> tfidf_vectorizer.fit_transform(X_train)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>X_test_tfidf <span class="op">=</span> tfidf_vectorizer.transform(X_test)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>clf_sgd <span class="op">=</span> SGDClassifier(loss<span class="op">=</span><span class="st">'log_loss'</span>, penalty<span class="op">=</span><span class="st">'l2'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">1e-3</span>, random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                        max_iter<span class="op">=</span><span class="dv">5</span>, tol<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>clf_sgd.fit(X_train_tfidf, y_train)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> clf_sgd.predict(X_test_tfidf)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on training set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_train_tfidf, y_train)))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on test set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_test_tfidf, y_test)))</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predicted, target_names<span class="op">=</span>target_names))</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>ConfusionMatrixDisplay.from_predictions(y_test, predicted, ax<span class="op">=</span>ax)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(<span class="ss">f"Confusion Matrix for </span><span class="sc">{</span>clf_sgd<span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">on the original documents"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of SGD classifier on training set: 0.910
Accuracy of SGD classifier on test set: 0.847

                                precision    recall  f1-score   support

             Produtos diversos       0.83      0.93      0.88       303
Produtos para telecomunicações       0.00      0.00      0.00        28
           Transmissores de RF       0.88      0.83      0.86       192

                      accuracy                           0.85       523
                     macro avg       0.57      0.59      0.58       523
                  weighted avg       0.80      0.85      0.82       523
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classificador-binário-produtos-diversos-vs-transmissores-de-rf" class="level3">
<h3 class="anchored" data-anchor-id="classificador-binário-produtos-diversos-vs-transmissores-de-rf">Classificador binário: produtos diversos vs transmissores de RF</h3>
<div id="5e51fbd6-b2b6-4f0d-a85c-f0f0c4f4631e" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>map_rf_transmitter <span class="op">=</span> {<span class="dv">0</span>: <span class="dv">0</span>, <span class="dv">1</span>: <span class="dv">0</span>, <span class="dv">2</span>: <span class="dv">1</span>}</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_cat_sample[<span class="st">'doc'</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_cat_sample[<span class="st">'rf_transmitter'</span>].<span class="bu">map</span>(map_rf_transmitter)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>target_names <span class="op">=</span> [<span class="st">'Produtos comuns'</span>, <span class="st">'Produtos transmissores de RF'</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>target_names_confusion <span class="op">=</span> [<span class="st">'Produtos comuns'</span>, <span class="st">'Transmissores de RF'</span>]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">724</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>tfidf_vectorizer <span class="op">=</span> TfidfVectorizer(tokenizer<span class="op">=</span>tokenizer)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>X_train_tfidf <span class="op">=</span> tfidf_vectorizer.fit_transform(X_train)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>X_test_tfidf <span class="op">=</span> tfidf_vectorizer.transform(X_test)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>clf_sgd <span class="op">=</span> SGDClassifier(loss<span class="op">=</span><span class="st">'log_loss'</span>, penalty<span class="op">=</span><span class="st">'l2'</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">1e-3</span>, random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                        max_iter<span class="op">=</span><span class="dv">5</span>, tol<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>clf_sgd.fit(X_train_tfidf, y_train)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> clf_sgd.predict(X_test_tfidf)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on training set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_train_tfidf, y_train)))</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy of SGD classifier on test set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(clf_sgd.score(X_test_tfidf, y_test)))</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'AUC of SGD classifier on test set: </span><span class="sc">{:.3f}</span><span class="st">'</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>     .<span class="bu">format</span>(roc_auc_score(y_test,clf_sgd.predict_proba(X_test_tfidf)[:,<span class="dv">1</span>])))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, predicted, target_names<span class="op">=</span>target_names))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>ConfusionMatrixDisplay.from_predictions(y_test, predicted, ax<span class="op">=</span>ax)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_ticklabels(target_names_confusion)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(<span class="ss">f"Confusion Matrix for </span><span class="sc">{</span>clf_sgd<span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">on the original documents"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of SGD classifier on training set: 0.942
Accuracy of SGD classifier on test set: 0.891
AUC of SGD classifier on test set: 0.952

                              precision    recall  f1-score   support

             Produtos comuns       0.89      0.95      0.92       331
Produtos transmissores de RF       0.89      0.80      0.84       192

                    accuracy                           0.89       523
                   macro avg       0.89      0.87      0.88       523
                weighted avg       0.89      0.89      0.89       523
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_consolidated_analysis_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>